# FileMaker

### 目次
- [レイアウト](#レイアウト)
- [データベース](#データベース)
- [スクリプト](#スクリプト)
- [カスタマ関数](#カスタマ関数)
- 値一覧
- テーマ

![](http://www.filemaker.com/jp/purchase/resellers/images/filemakerpro16advanced_icon.jpg)

<a name="レイアウト"></a>
#### レイアウト
0. トップメニュー  
1. 組合員関連
* 通知書各種  
* 日報
2. 代理店関連
* 精算請求書  
* 手数料明細書など  
* 通知書各種  
3. 商品  

|   | 火災 | 休業 | 総合 | 自動車 | 生命 | 所得 |
|:-------|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|
| 契約証書 | 〇 | 〇 | 〇 | 〇 | 〇 | 〇 |
| 異動系帳票 | 〇 | 〇 | 〇 | 〇 | 〇 | 〇 |
| 番号簿 | 〇 | 〇 | 〇 | 〇 | 〇 | 〇 |
| 日報 | 〇 | 〇 | 〇 | 〇 | 〇 | 〇 |
| 年齢超過 |   |   |   |   | 〇 | 〇 |
| 加入者証 |   |   |   |   | 〇 | 〇 |

4. 口座振替  
* 案内書各種  
* 依頼書  
* 不能者一覧表  
* 請求データ  
5. 商品共通  
* 通知書各種  
* 控除申告（未完成）  
* 前年同期（未完成）  
6. 満期案内  

|   | 火災 | 休業 | 総合 | 自動車 | 生命 | 所得 |
|:-------|:-------:|:-------:|:-------:|:-------:|:-------:|:-------:|
| 満期案内 | 〇 | 〇 | 〇 | 〇 |   |   |
| 変更通知書 | 〇 | 〇 | 〇 | 〇 |   |   |
| 宛名ラベル | 〇 | 〇 | 〇 | 〇 |   |   |
| 満期切れ確認 | 〇 | 〇 | 〇 |   |   |   |
| 代理所別満期一覧 | 〇 | 〇 | 〇 | 〇 |   |   |
| 継続申込書 | 〇 | 〇 | 〇 | 〇 |   |   |


<a name="データベース"></a>
#### データベース
大きく２つに分ける：  
* ESS経由で*仮想テーブル*（リアルタイム更新）
* FileMakerが持つ**テーブル**（定時インポート更新）
  
* m_code, m_statusなどのマスタ系が「帳票マスタ.fmp12」に保存し、
他のファイルから参照されている
* t_keiyaku_ido_rirekiは商品毎でそれぞれのファイルへインポートされている
* 契約ID、更新回数、異動Noの３つをキーとして
「会員テーブル＝契約テーブル＝異動テーブル＝明細テーブル」を繋げるのは
一般的なDB構造
* 仮想テーブルには本来のテーブルとビューがある、
ビューは特定の帳票が便利に作られるよう
事前に各テーブルから情報を纏めた仮想テーブルである、
扱い方は普通のテーブルと同じ



<a name="スクリプト"></a>
#### スクリプト
よく使われるパターン：  
###### 検索スクリプト
基本的に下記の順番でセットされている：
1. 検索条件確定
2. 新規ウインドウ/検索モード遷移/帳票画面遷移
3. エラー処理開始
4. フィールド設定/検索条件設定
5. 検索実行
6. エラー処理
7. ソート
8. 画面調整

###### データインポート/更新用スクリプト
スクリプトを動かすと、既存のデータを全て削除して、
外部DBからもう一度インポートすることにする。  
注意するのは、外部DBと繋がっているESSアダプタはサーバしか持っているので、
クライアントでなく、サーバ上でスクリプトを実行する必要がある。

###### ボタンのスクリプト  
* ページ遷移（トップメニュー ↔ 検索画面）
* ALL CLEAR
* ツールバーの隠蔽/表示

###### 初期化用のスクリプト
画面調整やラジオボタンのデフォルト値の設定の為  

<a name="カスタマ関数"></a>
#### カスタマ関数
よく使われる関数：

| 関数名 | 機能 | 引数1 | 引数2 | 引数3 | 引数4 | 引数5 |
|:--------|:--------|:--------|:--------|:--------|:--------|:--------|
| buildUp_Daihyo | 代表者全称の表示 | 代表者名 | 肩書 |   |   |   |
| buildUp_Shimei | 契約者全称の表示 | 契約者氏名 | 法人区分 | 前後区分 |   |   |
| getPostNum | 郵便番号にハイフン付く | 郵便番号 |   |   |   |   |
| contactJusho | 住所全称の表示 | 都道府県 | 住所1 | 住所2 | 住所3 | 分割マーク\* |
| getMasterNm | コードに対する名称を取得 | グループコード | コード |   |   |   |
| getShohinNm | 商品名取得 | 商品コード |   |   |   |   |
| getPlanNm | プラン名取得 | 商品コード | プランコード |   |   |   |
| getAge | 現在の年齢算出 | 生年月日 | 現在の日付 |   |   |   | 

\* 住所2と住所3の間に入れられる（改行など）  










